// ========================================
// BTC SaaS 主题切换样式
// ========================================

@use './variables.scss' as *;
@use './mixins.scss' as *;

// ========================================
// 防止主题切换时布局变化
// ========================================

/* 固定滚动条宽度，避免主题切换时的宽度变化 */
html {
  scrollbar-gutter: stable;
}

/* 防止主题切换时布局重排 */
.layout, .sidebar, .header, .content {
  contain: layout style;
  will-change: auto;
}

/* 确保主题切换时宽度稳定 */
.layout {
  width: 100% !important;
  min-width: 100% !important;
  max-width: 100% !important;
}

/* 防止主题切换时的闪烁和布局变化 */
html[data-theme-from] *,
html[data-theme-to] * {
  /* 在主题切换过程中保持布局稳定 */
  contain: layout style;
  transition: none !important;
  animation: none !important;
}

// ========================================
// 主题切换动画
// ========================================

// 主题切换容器
.theme-switch-container {
  position: relative;
  overflow: hidden;
}

// 主题切换动画
.theme-switch-animation {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: $z-index-modal;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at var(--origin-x, 50%) var(--origin-y, 50%), 
                               var(--theme-color, $primary-color) 0%, 
                               transparent 50%);
    transform: scale(0);
    animation: theme-switch-expand 0.6s ease-out forwards;
  }
}

@keyframes theme-switch-expand {
  0% {
    transform: scale(0);
    opacity: 1;
  }
  100% {
    transform: scale(4);
    opacity: 0;
  }
}

// ========================================
// 深色主题样式
// ========================================

html.dark {
  // Element Plus 经典深色主题变量配置
  --el-bg-color: #141414;
  --el-bg-color-page: #0a0a0a;
  --el-bg-color-overlay: #1d1e1f;
  --el-text-color-primary: #e5eaf3;
  --el-text-color-regular: #cfd3dc;
  --el-text-color-secondary: #a3a6ad;
  --el-text-color-placeholder: #8d9095;
  --el-border-color: #4c4d4f;
  --el-border-color-light: #414243;
  --el-border-color-lighter: #363637;
  --el-border-color-extra-light: #2b2b2c;
  --el-fill-color: #303030;
  --el-fill-color-light: #262727;
  --el-fill-color-lighter: #1d1d1d;
  --el-fill-color-extra-light: #191919;
  --el-fill-color-dark: #39393a;
  --el-fill-color-darker: #424243;
  --el-color-primary: #409eff;
  --el-color-primary-light-3: #79bbff;
  --el-color-primary-light-5: #a0cfff;
  --el-color-primary-light-7: #c6e2ff;
  --el-color-primary-light-8: #d9ecff;
  --el-color-primary-light-9: #ecf5ff;
  --el-color-primary-dark-2: #337ecc;
  
  /* 增强对比度的主题色变量 */
  --btc-primary-contrast: #ffffff;
  --btc-primary-hover: #66b1ff;
  --btc-primary-active: #337ecc;
  --el-color-success: #67c23a;
  --el-color-warning: #e6a23c;
  --el-color-danger: #f56c6c;
  --el-color-info: #909399;
  --el-color-white: #ffffff;
  --el-color-black: #000000;
  
  // 滚动条深色主题 - 与无感滚动条系统兼容
  // 注意：这些样式会被 .scrollarea 类覆盖，仅作为后备
  
  &::-webkit-scrollbar {
    width: 10px;
    height: 10px;
    background: transparent; /* 透明背景，符合无感设计 */
  }
  
  &::-webkit-scrollbar-track {
    background: transparent; /* 透明轨道，符合无感设计 */
    border-radius: 5px;
  }
  
  &::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2); /* 更透明，符合无感设计 */
    border-radius: 5px;
    border: 1px solid transparent;
    
    &:hover {
      background: rgba(255, 255, 255, 0.4); /* 悬停时稍微明显 */
    }
    
    &:active {
      background: rgba(255, 255, 255, 0.6); /* 激活时明显 */
    }
  }
  
  &::-webkit-scrollbar-corner {
    background: transparent; /* 透明角落，符合无感设计 */
  }
  
  // Firefox 深色主题滚动条 - 与无感滚动条系统兼容
  *:not(.scrollarea):not(.scrollarea--main):not(.scrollarea--side) {
    scrollbar-width: thin; /* 使用细滚动条 */
    scrollbar-color: rgba(255, 255, 255, 0.2) transparent; /* 透明轨道 */
  }
  
  // 选择文本深色主题
  &::selection {
    background-color: rgba(var(--el-color-primary), 0.3);
    color: var(--el-text-color-primary);
  }
  
  &::-moz-selection {
    background-color: rgba(var(--el-color-primary), 0.3);
    color: var(--el-text-color-primary);
  }
  
  // 全局文本颜色适配
  body {
    color: var(--el-text-color-primary);
    background-color: var(--el-bg-color-page);
  }
  
  // 标题颜色适配
  h1, h2, h3, h4, h5, h6 {
    color: var(--el-text-color-primary);
  }
  
  // 段落颜色适配
  p {
    color: var(--el-text-color-regular);
  }
  
  // 链接颜色适配
  a {
    color: var(--el-color-primary);
    
    &:hover {
      color: var(--el-color-primary-light-3);
    }
  }
  
  // 通用文本元素颜色适配
  span, div, label, small, strong, em, b, i {
    color: inherit;
  }
  
  // 列表颜色适配
  ul, ol {
    color: var(--el-text-color-regular);
    
    li {
      color: var(--el-text-color-regular);
    }
  }
  
  // 表格文本颜色适配
  table {
    color: var(--el-text-color-regular);
    
    th, td {
      color: var(--el-text-color-regular);
    }
  }
  
  // 代码块颜色适配
  code, pre {
    color: var(--el-text-color-regular);
    background-color: var(--el-fill-color);
  }
  
  // 引用块颜色适配
  blockquote {
    color: var(--el-text-color-secondary);
    border-left-color: var(--el-border-color);
  }
  
  // 表单元素文本颜色适配
  input, textarea, select {
    color: var(--el-text-color-primary);
    
    &::placeholder {
      color: var(--el-text-color-placeholder);
    }
  }
  
  // 按钮文本颜色适配
  button {
    color: inherit;
  }
  
  // 卡片内容文本颜色适配
  .el-card {
    .el-card__body {
      color: var(--el-text-color-regular);
    }
  }
  
  // 页面内容区域文本颜色适配
  .main-content {
    color: var(--el-text-color-regular);
    
    .page-container {
      color: var(--el-text-color-regular);
    }
    
    .content-area {
      color: var(--el-text-color-regular);
    }
  }
  
  // 侧边栏文本颜色适配
  .sidebar {
    color: var(--el-text-color-regular);
  }
  
  // 头部文本颜色适配
  .header {
    color: var(--el-text-color-regular);
  }
}

// ========================================
// 主题切换按钮样式
// ========================================

.theme-toggle-btn {
  @include flex-center;
  @include square(40px);
  border-radius: $border-radius-full;
  background: transparent;
  border: 2px solid $border-color-light;
  color: $text-regular;
  @include transition(all, $transition-duration-base);
  cursor: pointer;
  
  &:hover {
    border-color: $primary-color;
    color: $primary-color;
    transform: rotate(180deg);
  }
  
  .el-icon {
    font-size: $font-size-medium;
  }
  
  // 深色主题下的样式
  html.dark & {
    border-color: var(--el-border-color);
    color: var(--el-text-color-regular);
    
    &:hover {
      border-color: var(--el-color-primary);
      color: var(--el-color-primary);
    }
  }
}

// ========================================
// 主题预设样式
// ========================================

// 默认主题
.theme-default {
  --primary-color: #{$primary-color};
  --success-color: #{$success-color};
  --warning-color: #{$warning-color};
  --danger-color: #{$danger-color};
  --info-color: #{$info-color};
}

// 蓝色主题
.theme-blue {
  --primary-color: #{$primary-color};
  --success-color: #{$success-color};
  --warning-color: #{$warning-color};
  --danger-color: #{$danger-color};
  --info-color: #{$info-color};
}

// 绿色主题
.theme-green {
  --primary-color: #{$success-color};
  --success-color: #{$primary-color};
  --warning-color: #{$warning-color};
  --danger-color: #{$danger-color};
  --info-color: #{$info-color};
}

// 紫色主题
.theme-purple {
  --primary-color: #8b5cf6;
  --success-color: #{$success-color};
  --warning-color: #{$warning-color};
  --danger-color: #{$danger-color};
  --info-color: #{$info-color};
}

// 橙色主题
.theme-orange {
  --primary-color: #{$warning-color};
  --success-color: #{$success-color};
  --warning-color: #{$primary-color};
  --danger-color: #{$danger-color};
  --info-color: #{$info-color};
}

// ========================================
// 主题切换过渡效果
// ========================================

// 全局过渡效果
* {
  @include transition(background-color, $transition-duration-base);
  @include transition(border-color, $transition-duration-base);
  @include transition(color, $transition-duration-base);
}

// 特定元素的过渡效果
.el-button,
.el-input,
.el-select,
.el-table,
.el-card,
.el-dialog,
.el-menu {
  @include transition(all, $transition-duration-base);
}

// ========================================
// 主题切换指示器
// ========================================

.theme-indicator {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: $z-index-tooltip;
  @include flex-center;
  @include square(32px);
  border-radius: $border-radius-full;
  background: $primary-color;
  color: $white;
  font-size: $font-size-small;
  font-weight: $font-weight-medium;
  @include transition(all, $transition-duration-base);
  opacity: 0;
  transform: scale(0.8);
  
  &.show {
    opacity: 1;
    transform: scale(1);
  }
  
  // 深色主题下的样式
  html.dark & {
    background: var(--el-color-primary);
    color: var(--el-color-white);
  }
}

// ========================================
// 主题切换面板
// ========================================

.theme-panel {
  position: fixed;
  top: 50%;
  right: 20px;
  transform: translateY(-50%);
  z-index: $z-index-popover;
  background: $bg-color-overlay;
  border: 1px solid $border-color-light;
  border-radius: $border-radius-lg;
  padding: $spacing-md;
  @include box-shadow($shadow-lg);
  @include transition(all, $transition-duration-base);
  
  .theme-option {
    @include flex-center;
    @include square(40px);
    border-radius: $border-radius-base;
    margin-bottom: $spacing-sm;
    cursor: pointer;
    @include transition(all, $transition-duration-fast);
    
    &:last-child {
      margin-bottom: 0;
    }
    
    &:hover {
      transform: scale(1.1);
    }
    
    &.active {
      border: 2px solid var(--el-color-primary);
    }
  }
  
  // 深色主题下的样式
  html.dark & {
    background: var(--el-bg-color-overlay);
    border-color: var(--el-border-color);
  }
}

// ========================================
// 主题切换动画类
// ========================================

.theme-transitioning {
  pointer-events: none;
  
  * {
    @include transition(none);
  }
}

.theme-transition-complete {
  pointer-events: auto;
  
  * {
    @include transition(all, $transition-duration-base);
  }
}
