/* ========== 全局开关与基础 ========== */
:root {
  view-transition-name: app;
  --vt-duration: .24s;
  --pivot: 100% 0%;              /* 右上角锚点 */
}

/* 关掉 UA 默认 cross-fade */
::view-transition-old(app), ::view-transition-new(app) { animation: none; }

/* 局部别拿独立快照 */
.sidebar, .header, .content { view-transition-name: none; }

/* ========== 亮 -> 暗：new 从右上扩散 ========== */
:root[data-theme-from="light"][data-theme-to="dark"]::view-transition-new(app) {
  clip-path: circle(0 at var(--pivot));
  animation: vt-expand var(--vt-duration) cubic-bezier(.2,.8,.2,1) both;
}
@keyframes vt-expand { to { clip-path: circle(140vmax at var(--pivot)); } }

/* ========== 暗 -> 亮：new 外圈收拢回右上（用 mask 挖洞） ========== */
/* 注册可动画自定义属性（Chrome/Safari 必需） */
@property --r { syntax: '<length>'; inherits: false; initial-value: 140vmax; }

/* 标准语法 */
:root[data-theme-from="dark"][data-theme-to="light"]::view-transition-new(app) {
  --r: 140vmax; /* 起点：洞很大，new 只露外圈 */
  mask: radial-gradient(
    circle at var(--pivot),
    transparent 0, transparent var(--r),   /* 洞内透明 → old 可见 */
    #000 calc(var(--r) + 0.1px), #000 140vmax  /* 外圈不透明 → new 可见 */
  );
  mask-mode: luminance;
  animation: vt-outside-shrink var(--vt-duration) cubic-bezier(.2,.8,.2,1) both;
}
/* WebKit 前缀（Safari） */
:root[data-theme-from="dark"][data-theme-to="light"]::view-transition-new(app) {
  -webkit-mask: radial-gradient(
    circle at var(--pivot),
    transparent 0, transparent var(--r),
    #000 calc(var(--r) + 0.1px), #000 140vmax
  );
}

@keyframes vt-outside-shrink {
  to { --r: 0vmax; } /* 洞缩到右上角一个点 → new 全屏，完成"收拢回右上" */
}

/* old 两个场景都静置即可 */
:root[data-theme-from="light"][data-theme-to="dark"]::view-transition-old(app),
:root[data-theme-from="dark"][data-theme-to="light"]::view-transition-old(app) {
  animation: none;
}

/* 可选：调试描边（开发时开启，生产删） */
:root::view-transition-new(app){ outline:1px dashed rgba(0,255,0,.25); }
:root::view-transition-old(app){ outline:1px dashed rgba(255,0,0,.25); }

/* ========== ElMessage 定位修复 ========== */
/* 样式已移至 element-plus-protection.css，这里只保留注释 */

/* 修复ElMessageBox定位 */
.el-message-box__wrapper {
  position: fixed !important;
  z-index: 10000 !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  transform: none !important;
  
  /* 确保在响应式布局中正确显示 */
  pointer-events: auto !important;
}

/* 修复ElMessage在主题切换时的定位 */
[data-theme-from] .el-message,
[data-theme-to] .el-message {
  position: fixed !important;
  transform: none !important;
}

/* 修复ElMessage在侧边栏折叠/展开时的定位 */
.layout-shell.is-collapsed .el-message,
.layout-shell:not(.is-collapsed) .el-message {
  position: fixed !important;
  right: 20px !important;
  transform: none !important;
}
